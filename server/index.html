<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Tasks</title>
</head>

<body>

    <div id="root"></div>

<script>
const api_key = "a5598889-fb30-425a-b056-3998d79d3700";

let dateInPast = d => {
  return d.setHours(0, 0, 0, 0) <= new Date().setHours(0, 0, 0, 0)
};

let completeTask = id => {
    fetch(`http://localhost:5000/api/tasks/complete/${id}`, {method: "POST", headers: {"X-API-Key": api_key}})
    .then(response => response.json())
    .then(data => {
        updateTasks()
    })
    .catch((error) => {
    console.log(error);
});
}

let updateTasks = () => {
    document.querySelector("#root").innerHTML = "";
    fetch("http://localhost:5000/api/tasks", {headers: {"X-API-Key": api_key}})
    .then(response => response.json())
    .then(data => {
    data.forEach(t => {
        let e = document.createElement("div");
        let s = document.createElement("span");
        if (dateInPast(new Date(t.deadline * 1000))) {
            s.style.color = "red";
        }
        let d = new Date(t.deadline * 1000).toLocaleDateString("da-DK", {year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit"});
        s.innerText = d;
        let desc = document.createElement("span");
        desc.innerText = `${t.description} `;
        let b = document.createElement("button");
        b.textContent = "Complete";
        b.addEventListener("click", () => completeTask(t.id));
        e.appendChild(desc);
        e.appendChild(s);
        e.appendChild(b);
        document.querySelector("#root").appendChild(e);
    });
    })
    .catch((error) => {
        console.log(error);
    });
}

updateTasks();
</script>

</body>
</html>